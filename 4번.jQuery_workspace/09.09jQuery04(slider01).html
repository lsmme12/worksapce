<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jquery연습</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <style>
        .animation-canvas{width: 600px;height: 400px;overflow:hidden; position: relative;}
        .slider-panel{width: 3000px; position: relative;}
        .slider-image{float: left;width: 600px;height: 400px;}
        .control-panel{position: absolute;bottom: 10px;left: 270px;overflow: hidden;color: white;}
        .dot{font-size: 30px; cursor: pointer;}
        .arrow-next, .arrow-prev{
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
        }
        .arrow-prev{
            left: 5px;
        }
        .arrow-next{
            right: 5px;
        }
        /* --추가-- 화살표 클릭 우선순위와 커서 */
        .arrow-prev, .arrow-next{
            z-index: 1000;
            cursor: pointer;
            user-select: none;
        }
        /* --추가-- 인디케이터가 슬라이드 위로 보이도록(선택) */
        .control-panel{
            z-index: 500;
        }
        
        /* --추가-- 도트 스타일 (○/● 표시) */
        .dot{
            font-size: 22px;
            margin: 0 4px;
            color: #bbb;
        }
        .dot.active{
            color: #fff;
        }
    </style>
    
    <script>
        $(document).ready(function(){
            //슬라이더를 움직이게 하는 함수
            function moveSlider(index){
                let wimllMoveLeft = -(index * 600); // 왼쪽으로 index*600만큼 이동
                $('.slider-panel').animate({ left: wimllMoveLeft }, 'slow');
            }
            // indicator클릭시 실행
            $('.dot').click(function(){
                console.log($(this).index());
                moveSlider($(this).index()); //$(this).index()는 click event가 발생한 dot의 index를 반환
            });

            /* --추가-- 초기 left 값 보정 (animate 기준점 확보) */
            $('.slider-panel').css({ left: 0 });

            /* --추가-- 현재 인덱스/총 개수 상태 변수 */
            let currentIndex = 0;
            const total = $('.slider-image').length;

            /* --추가-- dot 클릭 시 currentIndex 동기화 (기존 핸들러는 그대로 두고, 상태만 맞춰줌) */
            // $('.control-panel').on('click.dotSync', '.dot', function(){
            //     currentIndex = $(this).index();
            // });

            // /* --추가-- 기존 잘못된 화살표 핸들러 제거 후 재바인딩 */
            // // $('.arrow-prev').off('click').on('click', function(){
            // //     currentIndex = (currentIndex - 1 + total) % total; // 맨 앞에서 뒤로 래핑
            // //     moveSlider(currentIndex);
            // // });
            // // $('.arrow-next').off('click').on('click', function(){
            // //     currentIndex = (currentIndex + 1) % total;         // 맨 뒤에서 앞으로 래핑
            // //     moveSlider(currentIndex);
            // // });
                       function updateDots(i){
                $('.dot').text('○').removeClass('active'); // 모두 ○
                $('.dot').eq(i).text('●').addClass('active'); // 현재만 ●
            }
            updateDots(0); // 초기 표시

            /* --추가-- dot 클릭 시 currentIndex 동기화 + 표시 */
            $('.control-panel').on('click.dotSync', '.dot', function(){
                currentIndex = $(this).index();
                updateDots(currentIndex);
            });

            /* --추가-- 기존 잘못된 화살표 핸들러 제거 후 재바인딩 */
            $('.arrow-prev').off('click').on('click', function(){
                currentIndex = (currentIndex - 1 + total) % total; // 맨 앞에서 뒤로 래핑
                moveSlider(currentIndex);
                updateDots(currentIndex);
            });
            $('.arrow-next').off('click').on('click', function(){
                currentIndex = (currentIndex + 1) % total;         // 맨 뒤에서 앞으로 래핑
                moveSlider(currentIndex);
                updateDots(currentIndex);
            });
        });  
    </script>
</head>
<body>
    <div class="animation-canvas">
        <div class="slider-panel">
            <img src="img/pic1.jpg" alt="pic1" class="slider-image">
            <img src="img/pic2.jpg" alt="pic2" class="slider-image">
            <img src="img/pic3.jpg" alt="pic3" class="slider-image">
            <img src="img/pic4.jpg" alt="pic4" class="slider-image">
            <img src="img/pic5.jpg" alt="pic5" class="slider-image">
        </div>

        <div class="control-panel" style="text-align: center;">
            <span class="dot">*</span>
            <span class="dot">*</span>
            <span class="dot">*</span>
            <span class="dot">*</span>
            <span class="dot">*</span>
        </div>

        <div class="arrow-prev">◀</div>
        <div class="arrow-next">▶</div>
    </div>
</body>
</html>